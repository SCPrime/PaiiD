============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-8.4.2, pluggy-1.6.0
rootdir: C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend
configfile: pyproject.toml
plugins: anyio-4.10.0, asyncio-1.2.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 540 items

tests\contract\test_analytics_contracts.py FF                            [  0%]
tests\contract\test_market_contracts.py FFFF                             [  1%]
tests\contract\test_portfolio_contracts.py FFF                           [  1%]
tests\integration\test_ai_recommendation_flow_integration.py FF.F.ssFFss [  3%]
sFFFFFF                                                                  [  5%]
tests\integration\test_auth_integration.py FFF.FFFFFFFEE                 [  7%]
tests\integration\test_auth_integration_enhanced.py FFF.sFFsFFFFFFFFF    [ 10%]
tests\integration\test_backtesting_flow_integration.py FFs.......ss..FFF [ 13%]
                                                                         [ 13%]
tests\integration\test_market_data_flow_integration.py FFFFsF..FFFFFFFFF [ 16%]
                                                                         [ 16%]
tests\integration\test_monitoring_integration.py ...s.sssssFssFsss.sssss [ 21%]
sss..s                                                                   [ 22%]
tests\integration\test_news_analysis_integration.py ssssssss.sssFsssssss [ 25%]
                                                                         [ 25%]
tests\integration\test_options_trading_integration.py F..s...Fss.FFs.sFF [ 29%]
F                                                                        [ 29%]
tests\integration\test_portfolio_management_integration.py FFFFFsFFsFs.F [ 31%]
FFF.F                                                                    [ 32%]
tests\integration\test_trading_flow_integration.py FFFFFFF..F.F          [ 35%]
tests\integration\test_trading_integration.py EEEEEEEEEEEEE              [ 37%]
tests\test_analytics.py .........                                        [ 39%]
tests\test_api_endpoints.py ..................                           [ 42%]
tests\test_auth.py ........                                              [ 43%]
tests\test_backtest.py F..FFF.F..                                        [ 45%]
tests\test_database.py ........F..............                           [ 50%]
tests\test_health.py ................F...FF...                           [ 54%]
tests\test_imports.py ..............                                     [ 57%]
tests\test_integration.py ...FFFFF..FF...                                [ 60%]
tests\test_load_baseline.py .FFFFFFF                                     [ 61%]
tests\test_market.py .F.................                                 [ 65%]
tests\test_news.py ...............                                       [ 67%]
tests\test_orders.py .                                                   [ 67%]
tests\test_rate_limiting.py .FFF.FF.FF..F..F..FF....                     [ 72%]
tests\test_security.py ............                                      [ 74%]
tests\test_security_headers.py .............................F........... [ 82%]
...                                                                      [ 82%]
tests\test_strategies.py .FF...F....FF                                   [ 85%]
tests\unit\test_ai_unit.py ............                                  [ 87%]
tests\unit\test_analytics_unit.py .........                              [ 89%]
tests\unit\test_backtesting_unit.py FF.FFF                               [ 90%]
tests\unit\test_claude_unit.py F.FFFFFF                                  [ 91%]
tests\unit\test_market_data_unit.py ...                                  [ 92%]
tests\unit\test_market_unit.py FFFF                                      [ 92%]
tests\unit\test_ml_sentiment_unit.py F.F.                                [ 93%]
tests\unit\test_ml_unit.py ....                                          [ 94%]
tests\unit\test_monitoring_unit.py .....                                 [ 95%]
tests\unit\test_news_unit.py .FF.                                        [ 96%]
tests\unit\test_options_unit.py F.F                                      [ 96%]
tests\unit\test_orders_unit.py F.FFFF                                    [ 97%]
tests\unit\test_portfolio_unit.py F.FF                                   [ 98%]
tests\unit\test_positions_unit.py FFFF                                   [ 99%]
tests\unit\test_scheduler_unit.py ..FF                                   [100%]

=================================== ERRORS ====================================
__ ERROR at setup of TestAuthenticationPerformance.test_login_response_time ___
file C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\integration\test_auth_integration.py, line 217
      def test_login_response_time(self, client, benchmark):
E       fixture 'benchmark' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, cov, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_alpaca_client, mock_cache, mock_external_apis, mock_market_indices, mock_tradier_client, mock_tradier_quotes, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_strategy, sample_trade, sample_user, test_db, test_timestamp, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\integration\test_auth_integration.py:217
_ ERROR at setup of TestAuthenticationPerformance.test_session_validation_response_time _
file C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\integration\test_auth_integration.py, line 230
      def test_session_validation_response_time(self, client, benchmark):
E       fixture 'benchmark' not found
>       available fixtures: _class_scoped_runner, _function_scoped_runner, _module_scoped_runner, _package_scoped_runner, _session_scoped_runner, anyio_backend, anyio_backend_name, anyio_backend_options, auth_headers, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, capteesys, client, cov, doctest_namespace, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, mock_alpaca_client, mock_cache, mock_external_apis, mock_market_indices, mock_tradier_client, mock_tradier_quotes, monkeypatch, no_cover, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, sample_strategy, sample_trade, sample_user, test_db, test_timestamp, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\integration\test_auth_integration.py:230
_____ ERROR at setup of TestTradingIntegration.test_order_validation_flow _____
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_____ ERROR at setup of TestTradingIntegration.test_market_buy_execution ______
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_____ ERROR at setup of TestTradingIntegration.test_limit_order_execution _____
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_____ ERROR at setup of TestTradingIntegration.test_sell_order_execution ______
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_ ERROR at setup of TestTradingIntegration.test_insufficient_balance_validation _
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
___ ERROR at setup of TestTradingIntegration.test_invalid_symbol_validation ___
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_ ERROR at setup of TestTradingIntegration.test_negative_quantity_validation __
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
______ ERROR at setup of TestTradingIntegration.test_order_cancellation _______
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
____ ERROR at setup of TestTradingIntegration.test_trade_history_retrieval ____
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
__ ERROR at setup of TestTradingIntegration.test_concurrent_order_execution ___
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_ ERROR at setup of TestTradingIntegration.test_portfolio_update_after_trade __
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_ ERROR at setup of TestTradingPerformance.test_order_validation_response_time _
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_ ERROR at setup of TestTradingPerformance.test_order_execution_response_time _
tests\integration\test_trading_integration.py:26: in authenticated_client
    token = response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
----------------------------- Captured log setup ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
================================== FAILURES ===================================
______________________ test_performance_metrics_contract ______________________
tests\contract\test_analytics_contracts.py:14: in test_performance_metrics_contract
    response = await client.get("/api/analytics/performance", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
_______________________ test_portfolio_history_contract _______________________
tests\contract\test_analytics_contracts.py:35: in test_portfolio_history_contract
    response = await client.get("/api/portfolio/history?period=1M", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
_____________________________ test_quote_contract _____________________________
tests\contract\test_market_contracts.py:14: in test_quote_contract
    response = await client.get("/api/market/quote/AAPL", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
____________________________ test_indices_contract ____________________________
tests\contract\test_market_contracts.py:35: in test_indices_contract
    response = await client.get("/api/market/indices", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
_______________________ test_market_conditions_contract _______________________
tests\contract\test_market_contracts.py:56: in test_market_conditions_contract
    response = await client.get("/api/market/conditions", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
____________________________ test_sectors_contract ____________________________
tests\contract\test_market_contracts.py:81: in test_sectors_contract
    response = await client.get("/api/market/sectors", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
_______________________ test_portfolio_summary_contract _______________________
tests\contract\test_portfolio_contracts.py:16: in test_portfolio_summary_contract
    response = await client.get("/api/portfolio/summary", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
___________________________ test_positions_contract ___________________________
tests\contract\test_portfolio_contracts.py:36: in test_positions_contract
    response = await client.get("/api/positions", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
____________________________ test_account_contract ____________________________
tests\contract\test_portfolio_contracts.py:59: in test_account_contract
    response = await client.get("/api/account", headers=auth_headers)
                     ^^^^^^^^^^
E   AttributeError: 'async_generator' object has no attribute 'get'
___________ TestAIRecommendationFlow.test_fetch_ai_recommendations ____________
tests\integration\test_ai_recommendation_flow_integration.py:37: in test_fetch_ai_recommendations
    assert response.status_code in [200, 422], f"AI recommendations failed: {response.text}"
E   AssertionError: AI recommendations failed: {"detail":"Failed to generate recommendations: Tradier API error: Invalid Access Token"}
E   assert 500 in [200, 422]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[WARNING] Redis connection failed: Error 11001 connecting to red-d3n6o4adbo4c73dr06dg:6379. getaddrinfo failed. - using in-memory fallback
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
ERROR    app.services.alpaca_client:alpaca_client.py:68 \u274c Alpaca get_account failed: {"message": "unauthorized."}\n\nWARNING  app.routers.ai:ai.py:741 \u26a0\ufe0f Could not fetch portfolio data: Alpaca account request failed: {"message": "unauthorized."}\n\nERROR    app.services.tradier_client:tradier_client.py:94 Tradier API error: 401 - Invalid Access Token\nERROR    app.routers.ai:ai.py:282 \u274c Failed to generate recommendations: Tradier API error: Invalid Access Token
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____ TestAIRecommendationFlow.test_ai_recommendation_with_market_context _____
tests\integration\test_ai_recommendation_flow_integration.py:69: in test_ai_recommendation_with_market_context
    assert response.status_code in [200, 422]
E   assert 500 in [200, 422]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
ERROR    app.services.alpaca_client:alpaca_client.py:68 \u274c Alpaca get_account failed: {"message": "unauthorized."}\n\nWARNING  app.routers.ai:ai.py:741 \u26a0\ufe0f Could not fetch portfolio data: Alpaca account request failed: {"message": "unauthorized."}\n\nERROR    app.services.tradier_client:tradier_client.py:94 Tradier API error: 401 - Invalid Access Token\nERROR    app.routers.ai:ai.py:282 \u274c Failed to generate recommendations: Tradier API error: Invalid Access Token
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestAIRecommendationFlow.test_ai_recommendation_filtering __________
tests\integration\test_ai_recommendation_flow_integration.py:147: in test_ai_recommendation_filtering
    assert response.status_code in [200, 422]
E   assert 500 in [200, 422]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
ERROR    app.services.alpaca_client:alpaca_client.py:68 \u274c Alpaca get_account failed: {"message": "unauthorized."}\n\nWARNING  app.routers.ai:ai.py:741 \u26a0\ufe0f Could not fetch portfolio data: Alpaca account request failed: {"message": "unauthorized."}\n\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.ai:ai.py:282 \u274c Failed to generate recommendations: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________________ TestAIAnalysisFlow.test_ai_chat_interface __________________
tests\integration\test_ai_recommendation_flow_integration.py:249: in test_ai_chat_interface
    assert response.status_code in [200, 422]
E   assert 403 in [200, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestAIAnalysisFlow.test_ai_strategy_generation ________________
tests\integration\test_ai_recommendation_flow_integration.py:272: in test_ai_strategy_generation
    assert response.status_code in [200, 422]
E   assert 403 in [200, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/ai/generate-strategy: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______ TestAIRecommendationPerformance.test_ai_recommendation_history ________
tests\integration\test_ai_recommendation_flow_integration.py:348: in test_ai_recommendation_history
    assert response.status_code == 200
E   assert 422 == 200
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______ TestAIRecommendationPerformance.test_ai_recommendation_accuracy _______
tests\integration\test_ai_recommendation_flow_integration.py:364: in test_ai_recommendation_accuracy
    assert response.status_code == 200
E   assert 422 == 200
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______ TestAIRecommendationPerformance.test_ai_recommendation_feedback _______
tests\integration\test_ai_recommendation_flow_integration.py:386: in test_ai_recommendation_feedback
    assert response.status_code in [200, 201, 422]
E   assert 403 in [200, 201, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/ai/recommendations/feedback: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_________________ TestAIErrorHandling.test_ai_api_unavailable _________________
tests\integration\test_ai_recommendation_flow_integration.py:403: in test_ai_api_unavailable
    assert response.status_code in [200, 503, 504]
E   assert 500 in [200, 503, 504]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
ERROR    app.services.alpaca_client:alpaca_client.py:68 \u274c Alpaca get_account failed: {"message": "unauthorized."}\n\nWARNING  app.routers.ai:ai.py:741 \u26a0\ufe0f Could not fetch portfolio data: Alpaca account request failed: {"message": "unauthorized."}\n\nERROR    app.services.tradier_client:tradier_client.py:94 Tradier API error: 401 - Invalid Access Token\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.routers.ai:ai.py:282 \u274c Failed to generate recommendations: Tradier API error: Invalid Access Token
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________________ TestAIErrorHandling.test_ai_timeout_handling _________________
tests\integration\test_ai_recommendation_flow_integration.py:420: in test_ai_timeout_handling
    assert response.status_code in [200, 408, 503, 504]
E   assert 403 in [200, 408, 503, 504]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_________________ TestAIErrorHandling.test_invalid_ai_request _________________
tests\integration\test_ai_recommendation_flow_integration.py:435: in test_invalid_ai_request
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestAuthenticationIntegration.test_user_registration_flow __________
tests\integration\test_auth_integration.py:54: in test_user_registration_flow
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_____________ TestAuthenticationIntegration.test_user_login_flow ______________
tests\integration\test_auth_integration.py:68: in test_user_login_flow
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
______ TestAuthenticationIntegration.test_login_with_invalid_credentials ______
tests\integration\test_auth_integration.py:85: in test_login_with_invalid_credentials
    assert "Invalid credentials" in data["detail"]
E   AssertionError: assert 'Invalid credentials' in 'Incorrect email or password'
------------------------------ Captured log call ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
____________ TestAuthenticationIntegration.test_session_validation ____________
tests\integration\test_auth_integration.py:104: in test_session_validation
    token = login_response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
------------------------------ Captured log call ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
__________ TestAuthenticationIntegration.test_session_without_token ___________
tests\integration\test_auth_integration.py:120: in test_session_without_token
    assert response.status_code == 401
E   assert 404 == 401
E    +  where 404 = <Response [404 Not Found]>.status_code
________ TestAuthenticationIntegration.test_session_with_invalid_token ________
tests\integration\test_auth_integration.py:128: in test_session_with_invalid_token
    assert response.status_code == 401
E   assert 404 == 401
E    +  where 404 = <Response [404 Not Found]>.status_code
_______________ TestAuthenticationIntegration.test_logout_flow ________________
tests\integration\test_auth_integration.py:138: in test_logout_flow
    token = login_response.json()["access_token"]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'access_token'
------------------------------ Captured log call ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
______________ TestAuthenticationIntegration.test_token_refresh _______________
tests\integration\test_auth_integration.py:162: in test_token_refresh
    refresh_token = login_response.json()["refresh_token"]
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'refresh_token'
------------------------------ Captured log call ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: trader@test.com
_______ TestAuthenticationIntegration.test_duplicate_email_registration _______
tests\integration\test_auth_integration.py:185: in test_duplicate_email_registration
    assert response.status_code == 409
E   assert 400 == 409
E    +  where 400 = <Response [400 Bad Request]>.status_code
_______ TestAuthenticationIntegration.test_password_strength_validation _______
tests\integration\test_auth_integration.py:209: in test_password_strength_validation
    assert response.status_code == 400
E   assert 422 == 400
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
_ TestAuthenticationIntegrationEnhanced.test_user_registration_complete_flow __
tests\integration\test_auth_integration_enhanced.py:122: in test_user_registration_complete_flow
    assert response.status_code == 201
E   assert 401 == 201
E    +  where 401 = <Response [401 Unauthorized]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_ TestAuthenticationIntegrationEnhanced.test_user_login_with_valid_credentials _
tests\integration\test_auth_integration_enhanced.py:146: in test_user_login_with_valid_credentials
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___ TestAuthenticationIntegrationEnhanced.test_login_with_invalid_password ____
tests\integration\test_auth_integration_enhanced.py:167: in test_login_with_invalid_password
    assert "Invalid credentials" in data["detail"]
E   AssertionError: assert 'Invalid credentials' in 'Incorrect email or password'
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.routers.auth:auth.py:197 \u26a0\ufe0f Failed login attempt for: test@example.com
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_ TestAuthenticationIntegrationEnhanced.test_session_validation_without_token _
tests\integration\test_auth_integration_enhanced.py:197: in test_session_validation_without_token
    assert response.status_code == 401
E   assert 404 == 401
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_ TestAuthenticationIntegrationEnhanced.test_session_validation_with_invalid_token _
tests\integration\test_auth_integration_enhanced.py:207: in test_session_validation_with_invalid_token
    assert response.status_code == 401
E   assert 404 == 401
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________ TestAuthenticationIntegrationEnhanced.test_token_refresh_flow ________
tests\integration\test_auth_integration_enhanced.py:232: in test_token_refresh_flow
    assert login_response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___ TestAuthenticationIntegrationEnhanced.test_duplicate_email_registration ___
tests\integration\test_auth_integration_enhanced.py:257: in test_duplicate_email_registration
    assert response.status_code == 409
E   assert 400 == 409
E    +  where 400 = <Response [400 Bad Request]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___ TestAuthenticationIntegrationEnhanced.test_password_strength_validation ___
tests\integration\test_auth_integration_enhanced.py:282: in test_password_strength_validation
    assert response.status_code == 400
E   assert 422 == 400
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____ TestAuthenticationIntegrationEnhanced.test_email_format_validation ______
tests\integration\test_auth_integration_enhanced.py:307: in test_email_format_validation
    assert response.status_code == 400
E   assert 422 == 400
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____ TestAuthenticationIntegrationEnhanced.test_risk_tolerance_validation _____
tests\integration\test_auth_integration_enhanced.py:326: in test_risk_tolerance_validation
    assert response.status_code == 400
E   assert 401 == 400
E    +  where 401 = <Response [401 Unauthorized]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____ TestAuthenticationIntegrationEnhanced.test_concurrent_login_attempts _____
tests\integration\test_auth_integration_enhanced.py:356: in test_concurrent_login_attempts
    assert status_code in [200, 429]  # Success or rate limited
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 401 in [200, 429]
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
ERROR    app.services.tradier_stream:tradier_stream.py:382 \U0001f6a8 'Too many sessions' error detected (1/5)\nERROR    app.services.tradier_stream:tradier_stream.py:393 \U0001f534 CIRCUIT BREAKER ACTIVATED - Too many sessions error. Active cleanup + 1 minute timeout.\nERROR    app.services.tradier_stream:tradier_stream.py:396 \U0001f534 Root cause: Zombie sessions from previous reconnections must expire (Tradier TTL: 5 min)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestAuthenticationSecurity.test_sql_injection_protection ___________
tests\integration\test_auth_integration_enhanced.py:372: in test_sql_injection_protection
    assert response.status_code in [400, 401]
E   assert 422 in [400, 401]
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 56s before retry...
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________ TestAuthenticationSecurity.test_password_not_logged _____________
tests\integration\test_auth_integration_enhanced.py:388: in test_password_not_logged
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 53s before retry...
------------------------------ Captured log call ------------------------------
DEBUG    app.middleware.security:security.py:155 [CSRF] Skipping validation for exempt path: /api/auth/login\nINFO     app.routers.auth:auth.py:209 \u2705 User logged in: test@example.com (role: personal_only)\nINFO     httpx:_client.py:1025 HTTP Request: POST http://testserver/api/auth/login "HTTP/1.1 401 Unauthorized"
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________ TestAuthenticationSecurity.test_token_expiration _______________
tests\integration\test_auth_integration_enhanced.py:402: in test_token_expiration
    assert response.status_code == 401
E   assert 404 == 401
E    +  where 404 = <Response [404 Not Found]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 49s before retry...
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestStrategyCreationFlow.test_create_simple_strategy _____________
tests\integration\test_backtesting_flow_integration.py:49: in test_create_simple_strategy
    assert response.status_code in [200, 201], f"Strategy creation failed: {response.text}"
E   AssertionError: Strategy creation failed: {"detail": "CSRF token missing. Include X-CSRF-Token header."}
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 46s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestStrategyCreationFlow.test_create_complex_strategy ____________
tests\integration\test_backtesting_flow_integration.py:89: in test_create_complex_strategy
    assert response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 43s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________ TestBacktestErrorHandling.test_invalid_date_range ______________
tests\integration\test_backtesting_flow_integration.py:513: in test_invalid_date_range
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 1s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________ TestBacktestErrorHandling.test_missing_strategy_id ______________
tests\integration\test_backtesting_flow_integration.py:531: in test_missing_strategy_id
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestBacktestErrorHandling.test_backtest_timeout_handling ___________
tests\integration\test_backtesting_flow_integration.py:551: in test_backtest_timeout_handling
    assert response.status_code in [200, 201, 202, 408, 504]
E   assert 403 in [200, 201, 202, 408, 504]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestMarketDataFlow.test_single_quote_retrieval ________________
tests\integration\test_market_data_flow_integration.py:34: in test_single_quote_retrieval
    assert response.status_code == 200, f"Quote request failed: {response.text}"
E   AssertionError: Quote request failed: {"detail":"Failed to fetch quote: Tradier API error: Invalid Access Token"}
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
ERROR    app.services.tradier_client:tradier_client.py:94 Tradier API error: 401 - Invalid Access Token\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier API error: Invalid Access Token
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestMarketDataFlow.test_multiple_symbol_quotes ________________
tests\integration\test_market_data_flow_integration.py:66: in test_multiple_symbol_quotes
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________________ TestMarketDataFlow.test_batch_quote_retrieval ________________
tests\integration\test_market_data_flow_integration.py:94: in test_batch_quote_retrieval
    pytest.fail(f"Unexpected status code: {response.status_code}")
E   Failed: Unexpected status code: 500
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:194 \u274c Tradier quotes request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________ TestMarketDataFlow.test_market_indices_retrieval _______________
tests\integration\test_market_data_flow_integration.py:104: in test_market_indices_retrieval
    assert spy_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for SPY: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestMarketDataFlow.test_quote_caching_behavior ________________
tests\integration\test_market_data_flow_integration.py:173: in test_quote_caching_behavior
    assert response1.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestMarketDataFlow.test_special_characters_in_symbol _____________
tests\integration\test_market_data_flow_integration.py:224: in test_special_characters_in_symbol
    assert response.status_code in [200, 400, 404]
E   assert 500 in [200, 400, 404]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for ^DJI: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________ TestMarketDataPerformance.test_quote_response_time ______________
tests\integration\test_market_data_flow_integration.py:244: in test_quote_response_time
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestMarketDataPerformance.test_concurrent_quote_requests ___________
tests\integration\test_market_data_flow_integration.py:269: in test_concurrent_quote_requests
    assert response.status_code in [200, 429, 503]  # Success, rate limit, or service unavailable
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 500 in [200, 429, 503]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for GOOGL: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for TSLA: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for META: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for NVDA: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AMZN: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for NFLX: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________ TestMarketDataIntegration.test_quote_to_order_flow ______________
tests\integration\test_market_data_flow_integration.py:290: in test_quote_to_order_flow
    assert quote_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestMarketDataIntegration.test_market_data_for_analytics ___________
tests\integration\test_market_data_flow_integration.py:318: in test_market_data_for_analytics
    assert quote_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_________ TestMarketDataIntegration.test_streaming_data_availability __________
tests\integration\test_market_data_flow_integration.py:342: in test_streaming_data_availability
    assert "status" in stream_data or "connected" in stream_data
E   AssertionError: assert ('status' in {'active_symbols': ['$DJI', 'COMP:GIDS'], 'provider': 'Tradier WebSocket', 'stream_count': 2, 'streaming_available': True} or 'connected' in {'active_symbols': ['$DJI', 'COMP:GIDS'], 'provider': 'Tradier WebSocket', 'stream_count': 2, 'streaming_available': True})
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestMarketDataErrorHandling.test_api_timeout_handling ____________
tests\integration\test_market_data_flow_integration.py:362: in test_api_timeout_handling
    assert response.status_code in [200, 503, 504]
E   assert 500 in [200, 503, 504]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestMarketDataErrorHandling.test_rate_limit_handling _____________
tests\integration\test_market_data_flow_integration.py:374: in test_rate_limit_handling
    assert response.status_code in [200, 429]
E   assert 500 in [200, 429]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestMarketDataErrorHandling.test_circuit_breaker_behavior __________
tests\integration\test_market_data_flow_integration.py:394: in test_circuit_breaker_behavior
    assert response.status_code in [200, 503]
E   assert 500 in [200, 503]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________________ TestAlertingSystem.test_create_alert_rule __________________
tests\integration\test_monitoring_integration.py:280: in test_create_alert_rule
    assert response.status_code in [200, 201, 422]
E   assert 403 in [200, 201, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/monitoring/alerts: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________________ TestAlertingSystem.test_acknowledge_alert __________________
tests\integration\test_monitoring_integration.py:328: in test_acknowledge_alert
    assert response.status_code in [200, 404]  # 404 if alert doesn't exist
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 403 in [200, 404]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/monitoring/alerts/1/acknowledge: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_________ TestNewsIntegrationWithTrading.test_news_alerts_integration _________
tests\integration\test_news_analysis_integration.py:405: in test_news_alerts_integration
    assert response.status_code in [200, 201, 422]
E   assert 403 in [200, 201, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 36s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/news/alerts: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________________ TestOptionsChainFlow.test_fetch_options_chain ________________
tests\integration\test_options_trading_integration.py:40: in test_fetch_options_chain
    assert response.status_code in [200, 422], f"Options chain request failed: {response.text}"
E   AssertionError: Options chain request failed: {"detail":"Error fetching options chain: Tradier API error: Invalid Access Token"}
E   assert 500 in [200, 422]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 10s before retry...
------------------------------ Captured log call ------------------------------
ERROR    app.services.tradier_client:tradier_client.py:94 Tradier API error: 401 - Invalid Access Token
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________ TestOptionsProposalsFlow.test_generate_options_proposal ___________
tests\integration\test_options_trading_integration.py:283: in test_generate_options_proposal
    assert response.status_code in [200, 201, 422]
E   assert 403 in [200, 201, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/options/proposal: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________ TestOptionsOrderExecution.test_options_order_validation ___________
tests\integration\test_options_trading_integration.py:410: in test_options_order_validation
    assert response.status_code in [400, 422, 404]
E   assert 403 in [400, 422, 404]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestOptionsOrderExecution.test_options_position_tracking ___________
tests\integration\test_options_trading_integration.py:418: in test_options_position_tracking
    assert positions_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestOptionsErrorHandling.test_invalid_expiration_date ____________
tests\integration\test_options_trading_integration.py:516: in test_invalid_expiration_date
    assert response.status_code in [200, 400, 422]
E   assert 500 in [200, 400, 422]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)
ERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________ TestOptionsErrorHandling.test_options_api_timeout ______________
tests\integration\test_options_trading_integration.py:528: in test_options_api_timeout
    assert response.status_code in [200, 503, 504]
E   assert 500 in [200, 503, 504]
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)
ERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________ TestOptionsErrorHandling.test_zero_contracts_rejection ____________
tests\integration\test_options_trading_integration.py:544: in test_zero_contracts_rejection
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestPortfolioManagementFlow.test_fetch_portfolio_summary ___________
tests\integration\test_portfolio_management_integration.py:45: in test_fetch_portfolio_summary
    assert portfolio_data is not None, "No portfolio endpoint found"
E   AssertionError: No portfolio endpoint found
E   assert None is not None
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:66 \u274c Tradier account request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________ TestPortfolioManagementFlow.test_fetch_positions _______________
tests\integration\test_portfolio_management_integration.py:66: in test_fetch_positions
    assert response.status_code == 200, f"Positions request failed: {response.text}"
E   AssertionError: Positions request failed: {"detail":"Failed to fetch Tradier positions: Tradier temporarily unavailable (circuit open)"}
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________ TestPortfolioManagementFlow.test_position_creation_after_buy _________
tests\integration\test_portfolio_management_integration.py:96: in test_position_creation_after_buy
    assert initial_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______ TestPortfolioManagementFlow.test_position_reduction_after_sell ________
tests\integration\test_portfolio_management_integration.py:151: in test_position_reduction_after_sell
    assert buy_response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________ TestPortfolioManagementFlow.test_portfolio_value_calculation _________
tests\integration\test_portfolio_management_integration.py:177: in test_portfolio_value_calculation
    assert portfolio_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:66 \u274c Tradier account request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________ TestPortfolioAnalytics.test_portfolio_diversification_metrics ________
tests\integration\test_portfolio_management_integration.py:251: in test_portfolio_diversification_metrics
    assert positions_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestPortfolioAnalytics.test_position_profit_loss_tracking __________
tests\integration\test_portfolio_management_integration.py:275: in test_position_profit_loss_tracking
    assert positions_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestAccountManagement.test_account_balance_retrieval _____________
tests\integration\test_portfolio_management_integration.py:347: in test_account_balance_retrieval
    assert account_data is not None
E   assert None is not None
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:66 \u274c Tradier account request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________ TestAccountManagement.test_account_settings_update ______________
tests\integration\test_portfolio_management_integration.py:415: in test_account_settings_update
    assert response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/settings: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'\nERROR    app.services.tradier_stream:tradier_stream.py:382 \U0001f6a8 'Too many sessions' error detected (1/5)\nERROR    app.services.tradier_stream:tradier_stream.py:393 \U0001f534 CIRCUIT BREAKER ACTIVATED - Too many sessions error. Active cleanup + 1 minute timeout.\nERROR    app.services.tradier_stream:tradier_stream.py:396 \U0001f534 Root cause: Zombie sessions from previous reconnections must expire (Tradier TTL: 5 min)
___________ TestPositionManagement.test_individual_position_details ___________
tests\integration\test_portfolio_management_integration.py:427: in test_individual_position_details
    assert positions_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 55s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________ TestPositionManagement.test_close_entire_position ______________
tests\integration\test_portfolio_management_integration.py:458: in test_close_entire_position
    assert buy_response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 51s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________ TestPositionManagement.test_position_cost_basis_tracking ___________
tests\integration\test_portfolio_management_integration.py:481: in test_position_cost_basis_tracking
    assert positions_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 47s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________ TestPortfolioErrorHandling.test_positions_empty_state ____________
tests\integration\test_portfolio_management_integration.py:522: in test_positions_empty_state
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 40s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.portfolio:portfolio.py:101 \u274c Tradier positions request failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestCompleteTradingFlow.test_complete_buy_flow ________________
tests\integration\test_trading_flow_integration.py:40: in test_complete_buy_flow
    assert quote_response.status_code == 200, f"Quote fetch failed: {quote_response.text}"
E   AssertionError: Quote fetch failed: {"detail":"Failed to fetch quote: Tradier temporarily unavailable (circuit open)"}
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 36s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestCompleteTradingFlow.test_complete_sell_flow _______________
tests\integration\test_trading_flow_integration.py:100: in test_complete_sell_flow
    assert buy_response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 33s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________________ TestCompleteTradingFlow.test_limit_order_flow ________________
tests\integration\test_trading_flow_integration.py:128: in test_limit_order_flow
    assert quote_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 30s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for TSLA: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________ TestCompleteTradingFlow.test_multi_symbol_trading_flow ____________
tests\integration\test_trading_flow_integration.py:161: in test_multi_symbol_trading_flow
    assert quote_response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 27s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.routers.market_data:market_data.py:103 \u274c Tradier quote request failed for AAPL: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_________ TestCompleteTradingFlow.test_portfolio_update_after_trades __________
tests\integration\test_trading_flow_integration.py:196: in test_portfolio_update_after_trades
    assert order_response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 23s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______ TestCompleteTradingFlow.test_order_validation_before_placement ________
tests\integration\test_trading_flow_integration.py:221: in test_order_validation_before_placement
    assert response.status_code in [400, 422, 404, 500]
E   assert 403 in [400, 422, 404, 500]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 20s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________ TestCompleteTradingFlow.test_concurrent_orders_handling ___________
tests\integration\test_trading_flow_integration.py:268: in test_concurrent_orders_handling
    assert response.status_code in [200, 201, 400, 422, 429, 503]
E   assert 403 in [200, 201, 400, 422, 429, 503]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 17s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_________ TestTradingFlowErrorHandling.test_network_timeout_handling __________
tests\integration\test_trading_flow_integration.py:340: in test_network_timeout_handling
    assert response.status_code in [200, 201, 503, 504]
E   assert 403 in [200, 201, 503, 504]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 8s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________ TestTradingFlowErrorHandling.test_duplicate_order_idempotency ________
tests\integration\test_trading_flow_integration.py:380: in test_duplicate_order_idempotency
    assert response1.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: 'list' object has no attribute 'items'\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 1s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/orders: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
________________________ test_backtest_endpoint_exists ________________________
tests\test_backtest.py:27: in test_backtest_endpoint_exists
    assert response.status_code in [200, 400, 422, 500, 503]
E   assert 403 in [200, 400, 422, 500, 503]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 32s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________________ test_backtest_with_different_symbols _____________________
tests\test_backtest.py:84: in test_backtest_with_different_symbols
    assert response.status_code in [200, 400, 422, 500], f"Unexpected status for {symbol}"
E   AssertionError: Unexpected status for SPY
E   assert 403 in [200, 400, 422, 500]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 23s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________________ test_backtest_validates_date_range ______________________
tests\test_backtest.py:102: in test_backtest_validates_date_range
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 19s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________________ test_backtest_validates_initial_capital ___________________
tests\test_backtest.py:120: in test_backtest_validates_initial_capital
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 16s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________________ test_backtest_sma_crossover_strategy _____________________
tests\test_backtest.py:169: in test_backtest_sma_crossover_strategy
    assert response.status_code in [
E   assert 403 in [200, 422, 500]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 10s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___________ TestStrategyModel.test_strategy_last_backtest_timestamp ___________
tests\test_database.py:151: in test_strategy_last_backtest_timestamp
    assert sample_strategy.last_backtest_at == now
E   AssertionError: assert datetime.datetime(2025, 10, 27, 6, 19, 26, 993009) == datetime.datetime(2025, 10, 27, 6, 19, 26, 993009, tzinfo=datetime.timezone.utc)
E    +  where datetime.datetime(2025, 10, 27, 6, 19, 26, 993009) = <Strategy(id=1, name='Test Momentum Strategy', type='momentum')>.last_backtest_at
______________ TestHealthMonitor.test_cache_hit_rate_calculation ______________
tests\test_health.py:312: in test_cache_hit_rate_calculation
    assert health["application"]["cache_hit_rate_percent"] == 66.67  # 2/3 * 100
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 66.66666666666666 == 66.67
------------------------------ Captured log call ------------------------------
WARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.alpaca_client:alpaca_client.py:68 \u274c Alpaca get_account failed: {"message": "unauthorized."}
__ TestHealthMonitorIntegration.test_health_endpoint_detailed_requires_auth ___
tests\test_health.py:352: in test_health_endpoint_detailed_requires_auth
    assert response.status_code == 401  # Unauthorized
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 200 == 401
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____ TestHealthMonitorIntegration.test_health_endpoint_detailed_with_auth _____
tests\test_health.py:360: in test_health_endpoint_detailed_with_auth
    assert "system" in data
E   AssertionError: assert 'system' in {'dependencies': {'alpaca_api': {'latency_ms': 341.252, 'message': 'Alpaca API responding (341ms)', 'status': 'healthy...tus': 'healthy'}}, 'status': 'degraded', 'time': '2025-10-27T06:19:44.627355+00:00', 'uptime_seconds': 772.032361, ...}
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestMarketDataEndpoints.test_get_options_chain ________________
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1393: in patched
    with self.decoration_helper(patched,
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1375: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1467: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1437: in get_original
    raise AttributeError(
E   AttributeError: <class 'app.services.tradier_client.TradierClient'> does not have the attribute 'get_options_chain'
____________________ TestMLEndpoints.test_detect_patterns _____________________
tests\test_integration.py:113: in test_detect_patterns
    assert response.status_code in [200, 401, 422, 500]
E   assert 403 in [200, 401, 422, 500]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/ml/backtest-patterns: Missing X-CSRF-Token header
________________ TestMLEndpoints.test_market_regime_detection _________________
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1393: in patched
    with self.decoration_helper(patched,
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1375: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py:526: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\unittest\mock.py:1451: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\pkgutil.py:528: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.ml' has no attribute 'regime_detection'. Did you mean: 'get_regime_detector'?
________________ TestTradingEndpoints.test_get_account_balance ________________
tests\test_integration.py:143: in test_get_account_balance
    assert response.status_code in [200, 401, 500]
E   assert 404 in [200, 401, 500]
E    +  where 404 = <Response [404 Not Found]>.status_code
___________________ TestTradingEndpoints.test_get_positions ___________________
tests\test_integration.py:159: in test_get_positions
    assert response.status_code in [200, 401, 500]
E   assert 404 in [200, 401, 500]
E    +  where 404 = <Response [404 Not Found]>.status_code
______________ TestErrorHandling.test_invalid_symbol_returns_404 ______________
tests\test_integration.py:196: in test_invalid_symbol_returns_404
    assert response.status_code in [400, 404, 500]  # Invalid symbol should error
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 422 in [400, 404, 500]
E    +  where 422 = <Response [422 Unprocessable Entity]>.status_code
____________ TestErrorHandling.test_malformed_request_returns_422 _____________
tests\test_integration.py:200: in test_malformed_request_returns_422
    assert response.status_code in [401, 422]  # Malformed request or unauthorized
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 403 in [401, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/ml/backtest-patterns: Missing X-CSRF-Token header
__________________________ test_load_market_indices ___________________________
tests\test_load_baseline.py:279: in test_load_market_indices
    ???
E   AssertionError: Market indices success rate too low: 0.0%
E   assert 0.0 >= 0.8
---------------------------- Captured stdout call -----------------------------

======================================================================
Load Test Results: Market Indices
======================================================================
Total Time:           0.53s
Requests/Second:      189.25
Success Rate:         0.0%
Error Rate:           100.0%
Timeout Rate:         0.0%

Response Times (ms):
  Average:            21.36
  Median:             19.96
  Min:                5.00
  Max:                37.98
  95th Percentile:    35.04
  99th Percentile:    37.98
======================================================================

________________________ test_load_ai_recommendations _________________________
tests\test_load_baseline.py:308: in test_load_ai_recommendations
    ???
E   AssertionError: AI recommendations success rate too low: 0.0%
E   assert 0.0 >= 0.7
---------------------------- Captured stdout call -----------------------------

======================================================================
Load Test Results: AI Recommendations
======================================================================
Total Time:           0.42s
Requests/Second:      120.19
Success Rate:         0.0%
Error Rate:           100.0%
Timeout Rate:         0.0%

Response Times (ms):
  Average:            10.88
  Median:             12.03
  Min:                0.00
  Max:                18.37
  95th Percentile:    17.33
  99th Percentile:    18.37
======================================================================

________________________ test_load_strategy_templates _________________________
tests\test_load_baseline.py:336: in test_load_strategy_templates
    ???
E   AssertionError: Strategy templates success rate too low: 0.0%
E   assert 0.0 >= 0.85
---------------------------- Captured stdout call -----------------------------

======================================================================
Load Test Results: Strategy Templates
======================================================================
Total Time:           0.54s
Requests/Second:      186.41
Success Rate:         0.0%
Error Rate:           100.0%
Timeout Rate:         0.0%

Response Times (ms):
  Average:            24.37
  Median:             22.45
  Min:                0.64
  Max:                56.21
  95th Percentile:    51.21
  99th Percentile:    56.21
======================================================================

_________________________ test_load_portfolio_summary _________________________
tests\test_load_baseline.py:364: in test_load_portfolio_summary
    metrics = result.calculate_metrics()
E   AssertionError: Portfolio summary success rate too low: 0.0%
E   assert 0.0 >= 0.8
---------------------------- Captured stdout call -----------------------------

======================================================================
Load Test Results: Portfolio Summary
======================================================================
Total Time:           0.49s
Requests/Second:      203.29
Success Rate:         0.0%
Error Rate:           100.0%
Timeout Rate:         0.0%

Response Times (ms):
  Average:            19.10
  Median:             16.65
  Min:                0.00
  Max:                52.32
  95th Percentile:    37.81
  99th Percentile:    52.32
======================================================================

_____________________________ test_load_positions _____________________________
tests\test_load_baseline.py:392: in test_load_positions
    )
E   AssertionError: Positions success rate too low: 0.0%
E   assert 0.0 >= 0.8
---------------------------- Captured stdout call -----------------------------

======================================================================
Load Test Results: Positions
======================================================================
Total Time:           0.53s
Requests/Second:      189.91
Success Rate:         0.0%
Error Rate:           100.0%
Timeout Rate:         0.0%

Response Times (ms):
  Average:            22.80
  Median:             22.13
  Min:                3.15
  Max:                72.64
  95th Percentile:    47.25
  99th Percentile:    72.64
======================================================================

_______________________________ test_load_news ________________________________
tests\test_load_baseline.py:420: in test_load_news
    url, num_requests=50, concurrent=5, headers=headers, timeout=20.0
E   AssertionError: News success rate too low: 0.0%
E   assert 0.0 >= 0.7
---------------------------- Captured stdout call -----------------------------

======================================================================
Load Test Results: News
======================================================================
Total Time:           0.37s
Requests/Second:      133.70
Success Rate:         0.0%
Error Rate:           100.0%
Timeout Rate:         0.0%

Response Times (ms):
  Average:            7.74
  Median:             6.93
  Min:                0.00
  Max:                19.25
  95th Percentile:    17.36
  99th Percentile:    19.25
======================================================================

______________________ test_comprehensive_load_baseline _______________________
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_transports\default.py:101: in map_httpcore_exceptions
    yield
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_transports\default.py:394: in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\connection_pool.py:256: in handle_async_request
    raise exc from None
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\connection_pool.py:236: in handle_async_request
    response = await connection.handle_async_request(
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\connection.py:103: in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\http11.py:136: in handle_async_request
    raise exc
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\http11.py:106: in handle_async_request
    ) = await self._receive_response_headers(**kwargs)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\http11.py:177: in _receive_response_headers
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_async\http11.py:217: in _receive_event
    data = await self._network_stream.read(
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_backends\anyio.py:32: in read
    with map_exceptions(exc_map):
         ^^^^^^^^^^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py:158: in __exit__
    self.gen.throw(value)
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpcore\_exceptions.py:14: in map_exceptions
    raise to_exc(exc) from exc
E   httpcore.ReadError

The above exception was the direct cause of the following exception:
tests\test_load_baseline.py:446: in test_comprehensive_load_baseline
    print(f"Base URL: {BASE_URL}")
                ^^^^^^^^^^^^^^^^^^^
tests\test_load_baseline.py:68: in get_jwt_token
    login_response = await client.post(
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_client.py:1859: in post
    return await self.request(
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_client.py:1540: in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_client.py:1629: in send
    response = await self._send_handling_auth(
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_client.py:1657: in _send_handling_auth
    response = await self._send_handling_redirects(
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_client.py:1694: in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_client.py:1730: in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_transports\default.py:393: in handle_async_request
    with map_httpcore_exceptions():
         ^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.12_3.12.2800.0_x64__qbz5n2kfra8p0\Lib\contextlib.py:158: in __exit__
    self.gen.throw(value)
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\httpx\_transports\default.py:118: in map_httpcore_exceptions
    raise mapped_exc(message) from exc
E   httpx.ReadError
---------------------------- Captured stdout call -----------------------------

======================================================================
COMPREHENSIVE LOAD TEST BASELINE - Agent 7C
======================================================================
Base URL: http://127.0.0.1:8001
Test Date: 2025-10-27 02:20:04
======================================================================

Authenticating...
______________________ test_market_indices_requires_auth ______________________
tests\test_market.py:33: in test_market_indices_requires_auth
    assert response.status_code in [401, 403, 500]
E   assert 200 in [401, 403, 500]
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 47s before retry...
---------------------------- Captured stdout call -----------------------------
[Market] \u2705 Fetched live data from Tradier for Dow/NASDAQ
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
___ TestRateLimitBasics.test_rate_limit_headers_present_in_production_mode ____
tests\test_rate_limiting.py:46: in test_rate_limit_headers_present_in_production_mode
    assert limiter.enabled is False or limiter.headers_enabled is True
                                       ^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'Limiter' object has no attribute 'headers_enabled'. Did you mean: '_headers_enabled'?
____ TestRateLimitExceededHandler.test_rate_limit_exceeded_handler_format _____
tests\test_rate_limiting.py:60: in test_rate_limit_exceeded_handler_format
    mock_exc = RateLimitExceeded("100 per 1 minute. Retry after 60 seconds")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\slowapi\errors.py:19: in __init__
    if limit.error_message:
       ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'error_message'
_ TestRateLimitExceededHandler.test_rate_limit_exceeded_handler_retry_after_extraction _
tests\test_rate_limiting.py:97: in test_rate_limit_exceeded_handler_retry_after_extraction
    mock_exc = RateLimitExceeded(exc_detail)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\slowapi\errors.py:19: in __init__
    if limit.error_message:
       ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'error_message'
________ TestRateLimitDecorators.test_rate_limit_decorator_application ________
tests\test_rate_limiting.py:133: in test_rate_limit_decorator_application
    decorated = rate_limit_standard(dummy_endpoint)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
app\middleware\rate_limit.py:83: in rate_limit_standard
    return limiter.limit("60/minute")(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\slowapi\extension.py:713: in decorator
    raise Exception(
E   Exception: No "request" or "websocket" argument on function "<function TestRateLimitDecorators.test_rate_limit_decorator_application.<locals>.dummy_endpoint at 0x00000213AAC31940>"
__________ TestRateLimitConfiguration.test_rate_limiter_initialized ___________
tests\test_rate_limiting.py:146: in test_rate_limiter_initialized
    assert limiter.enabled is False
E   assert True is False
E    +  where True = <slowapi.extension.Limiter object at 0x000002138E080950>.enabled
____ TestRateLimitConfiguration.test_rate_limiter_configuration_production ____
tests\test_rate_limiting.py:167: in test_rate_limiter_configuration_production
    assert not settings.REDIS_URL
E   AssertionError: assert not 'redis://red-d3n6o4adbo4c73dr06dg:6379'
E    +  where 'redis://red-d3n6o4adbo4c73dr06dg:6379' = Settings(API_TOKEN='tuGlKvrYEoiJcv7r7oIy7zXM9pqVnaxN_74obFz6lVo', TRADIER_API_KEY='fbvCD3YvHQCfIiU0TLH0FYj71Oni', TRAD...NS_EXPIRY=300, CACHE_TTL_HISTORICAL_BARS=3600, CACHE_TTL_NEWS=300, CACHE_TTL_COMPANY_INFO=86400, CACHE_TTL_SCANNER=180).REDIS_URL
_____________ TestRateLimitIPKeying.test_rate_limit_key_function ______________
tests\test_rate_limiting.py:179: in test_rate_limit_key_function
    assert limiter.key_func == get_remote_address
           ^^^^^^^^^^^^^^^^
E   AttributeError: 'Limiter' object has no attribute 'key_func'. Did you mean: '_key_func'?
_________ TestRateLimitEndpointTypes.test_mutation_endpoints_callable _________
tests\test_rate_limiting.py:216: in test_mutation_endpoints_callable
    assert response.status_code in [200, 201, 422]
E   assert 403 in [200, 201, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 49s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____ TestRateLimitResetBehavior.test_rate_limit_would_reset_after_window _____
tests\test_rate_limiting.py:249: in test_rate_limit_would_reset_after_window
    assert limiter.default_limits is not None
           ^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'Limiter' object has no attribute 'default_limits'. Did you mean: '_default_limits'?
_____________ TestRateLimitHeaders.test_rate_limit_headers_format _____________
tests\test_rate_limiting.py:294: in test_rate_limit_headers_format
    mock_exc = RateLimitExceeded("100 per 1 minute")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\slowapi\errors.py:19: in __init__
    if limit.error_message:
       ^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'str' object has no attribute 'error_message'
________ TestRateLimitStorageBackend.test_memory_storage_in_test_mode _________
tests\test_rate_limiting.py:319: in test_memory_storage_in_test_mode
    assert TESTING is True
E   assert False is True
___ TestSecurityHeadersMiddlewareImplementation.test_middleware_registered ____
tests\test_security_headers.py:280: in test_middleware_registered
    assert SecurityHeadersMiddleware in middleware_types
E   AssertionError: assert <class 'app.middleware.security_headers.SecurityHeadersMiddleware'> in [<class 'starlette.middleware.Middleware'>, <class 'starlette.middleware.Middleware'>, <class 'starlette.middleware.Mi...tte.middleware.Middleware'>, <class 'starlette.middleware.Middleware'>, <class 'starlette.middleware.Middleware'>, ...]
________________________ test_strategies_requires_auth ________________________
tests\test_strategies.py:24: in test_strategies_requires_auth
    assert response.status_code in [401, 403, 500]
E   assert 200 in [401, 403, 500]
E    +  where 200 = <Response [200 OK]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 23s before retry...
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
____________________________ test_create_strategy _____________________________
tests\test_strategies.py:49: in test_create_strategy
    assert response.status_code in [201, 404, 405, 422]
E   assert 403 in [201, 404, 405, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 20s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies/save: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________________ test_create_strategy_validation _______________________
tests\test_strategies.py:138: in test_create_strategy_validation
    assert response.status_code in [400, 422]
E   assert 403 in [400, 422]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 7s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies/save: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________________ test_update_nonexistent_strategy _______________________
tests\test_strategies.py:232: in test_update_nonexistent_strategy
    assert response.status_code in [404, 405]
E   assert 403 in [404, 405]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 52s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies/00000000-0000-0000-0000-000000000000: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
______________________ test_delete_nonexistent_strategy _______________________
tests\test_strategies.py:240: in test_delete_nonexistent_strategy
    assert response.status_code in [401, 404]
E   assert 403 in [401, 404]
E    +  where 403 = <Response [403 Forbidden]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)\nWARNING  app.services.tradier_stream:tradier_stream.py:236 \u26a0\ufe0f Circuit breaker ACTIVE - waiting 49s before retry...
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/strategies/00000000-0000-0000-0000-000000000000: Missing X-CSRF-Token header
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
__________________ TestBacktesting.test_run_backtest_success __________________
tests\unit\test_backtesting_unit.py:87: in test_run_backtest_success
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
_____________ TestBacktesting.test_run_backtest_validation_error ______________
tests\unit\test_backtesting_unit.py:104: in test_run_backtest_validation_error
    assert response.status_code == 422
E   assert 403 == 422
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
_____________ TestBacktesting.test_run_backtest_insufficient_data _____________
tests\unit\test_backtesting_unit.py:128: in test_run_backtest_insufficient_data
    assert response.status_code in [200, 400]
E   assert 403 in [200, 400]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
_____________ TestBacktesting.test_run_backtest_different_symbols _____________
tests\unit\test_backtesting_unit.py:156: in test_run_backtest_different_symbols
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
___________ TestBacktesting.test_run_backtest_different_strategies ____________
tests\unit\test_backtesting_unit.py:195: in test_run_backtest_different_strategies
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/backtesting/run: Missing X-CSRF-Token header
_____________________ TestClaude.test_claude_chat_success _____________________
tests\unit\test_claude_unit.py:65: in test_claude_chat_success
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
________________ TestClaude.test_claude_chat_validation_error _________________
tests\unit\test_claude_unit.py:86: in test_claude_chat_validation_error
    assert response.status_code == 422
E   assert 403 == 422
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
_______________ TestClaude.test_claude_chat_api_not_configured ________________
tests\unit\test_claude_unit.py:97: in test_claude_chat_api_not_configured
    assert response.status_code in [503, 500]
E   assert 403 in [503, 500]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
_______________ TestClaude.test_claude_chat_with_system_prompt ________________
tests\unit\test_claude_unit.py:121: in test_claude_chat_with_system_prompt
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
________________ TestClaude.test_claude_chat_multiple_messages ________________
tests\unit\test_claude_unit.py:151: in test_claude_chat_multiple_messages
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
_________________ TestClaude.test_claude_chat_xss_prevention __________________
tests\unit\test_claude_unit.py:179: in test_claude_chat_xss_prevention
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
________________ TestClaude.test_claude_chat_different_models _________________
tests\unit\test_claude_unit.py:210: in test_claude_chat_different_models
    assert response.status_code == 200
E   assert 403 == 200
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/claude/chat: Missing X-CSRF-Token header
______________________ TestMarket.test_get_quote_success ______________________
tests\unit\test_market_unit.py:52: in test_get_quote_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
__________________ TestMarket.test_get_quotes_batch_success ___________________
tests\unit\test_market_unit.py:73: in test_get_quotes_batch_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_________________ TestMarket.test_get_historical_bars_success _________________
tests\unit\test_market_unit.py:91: in test_get_historical_bars_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_________________ TestMarket.test_get_market_scanner_success __________________
tests\unit\test_market_unit.py:110: in test_get_market_scanner_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_____________ TestMLSentiment.test_get_sentiment_analysis_success _____________
tests\unit\test_ml_sentiment_unit.py:48: in test_get_sentiment_analysis_success
    assert response.status_code == 200
E   assert 500 == 200
E    +  where 500 = <Response [500 Internal Server Error]>.status_code
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)
------------------------------ Captured log call ------------------------------
ERROR    app.routers.ml_sentiment:ml_sentiment.py:172 Error getting sentiment for AAPL: object Mock can't be used in 'await' expression
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_______________ TestMLSentiment.test_get_trade_signals_success ________________
tests\unit\test_ml_sentiment_unit.py:85: in test_get_trade_signals_success
    mock_signal = TradeSignal(
E   pydantic_core._pydantic_core.ValidationError: 2 validation errors for TradeSignal
E   strength
E     Input should be 'STRONG', 'MODERATE' or 'WEAK' [type=enum, input_value='strong', input_type=str]
E       For further information visit https://errors.pydantic.dev/2.11/v/enum
E   indicators
E     Field required [type=missing, input_value={'symbol': 'AAPL', 'signa...=datetime.timezone.utc)}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
---------------------------- Captured stdout setup ----------------------------
[OK] Cache service initialized
[OK] Scheduler initialized and started
[INFO] Market data: Tradier API | Trade execution: Alpaca Paper Trading
[OK] Tradier streaming service started (running in background)
[INFO] Queued subscription to $DJI and COMP (will connect when circuit breaker clears)
----------------------------- Captured log setup ------------------------------
ERROR    app.core.prelaunch:prelaunch.py:403 \u274c Pre-launch validation failed!\nERROR    app.main:main.py:440 \U0001f6a8 Pre-launch validation failed!\nWARNING  app.main:main.py:446 Pre-launch validation reported errors but STRICT_PRELAUNCH is disabled; continuing startup\nERROR    app.core.startup_validator:startup_validator.py:144 \u274c Tradier API authentication failed (invalid API key)\nERROR    app.core.startup_validator:startup_validator.py:145 Fix: Check TRADIER_API_KEY in .env\nWARNING  app.core.startup_validator:startup_validator.py:96 \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:226 \u274c 1 CRITICAL ERROR(S):\nERROR    app.core.startup_validator:startup_validator.py:228   \u274c Tradier API authentication failed (invalid API key)\nWARNING  app.core.startup_validator:startup_validator.py:231 \u26a0\ufe0f 1 WARNING(S):\nWARNING  app.core.startup_validator:startup_validator.py:233   \u26a0\ufe0f SENTRY_DSN not set (optional)\nERROR    app.core.startup_validator:startup_validator.py:252 \U0001f6a8 STARTUP VALIDATION FAILED - APPLICATION CANNOT START\nERROR    app.core.startup_validator:startup_validator.py:253 Fix configuration errors and restart the application\nWARNING  app.main:main.py:472 \u26a0\ufe0f Startup validation failed but continuing (STRICT_STARTUP_VALIDATION disabled)\nWARNING  app.services.tradier_client:tradier_client.py:71 [Tradier Circuit] OPEN (3 consecutive failures)\nERROR    app.services.tradier_client:tradier_client.py:102 Tradier request failed: Tradier temporarily unavailable (circuit open)\nERROR    app.services.tradier_stream:tradier_stream.py:553 \u274c Cache warming failed: Tradier temporarily unavailable (circuit open)
---------------------------- Captured log teardown ----------------------------
ERROR    app.main:main.py:606 [ERROR] Scheduler shutdown error: TradingScheduler.shutdown() got an unexpected keyword argument 'wait'
_____________________ TestNews.test_get_news_unauthorized _____________________
tests\unit\test_news_unit.py:35: in test_get_news_unauthorized
    assert response.status_code in [401, 403]
E   assert 404 in [401, 403]
E    +  where 404 = <Response [404 Not Found]>.status_code
____________________ TestNews.test_get_market_news_success ____________________
tests\unit\test_news_unit.py:42: in test_get_market_news_success
    assert response.status_code in [200, 404]
E   assert 401 in [200, 404]
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_________________ TestOptions.test_get_options_chain_success __________________
tests\unit\test_options_unit.py:42: in test_get_options_chain_success
    assert response.status_code in [200, 404, 500]
E   assert 401 in [200, 404, 500]
E    +  where 401 = <Response [401 Unauthorized]>.status_code
______________ TestOptions.test_get_options_expirations_success _______________
tests\unit\test_options_unit.py:71: in test_get_options_expirations_success
    assert response.status_code in [200, 404, 500]
E   assert 401 in [200, 404, 500]
E    +  where 401 = <Response [401 Unauthorized]>.status_code
___________________ TestOrders.test_trading_execute_dry_run ___________________
tests\unit\test_orders_unit.py:53: in test_trading_execute_dry_run
    assert response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:106 [CSRF] Validation failed: Token not found
WARNING  app.middleware.security:security.py:176 [CSRF] Blocked request to /api/trading/execute: Invalid or expired token
________________ TestOrders.test_order_templates_list_success _________________
tests\unit\test_orders_unit.py:78: in test_order_templates_list_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
_____________ TestOrders.test_order_template_get_by_id_not_found ______________
tests\unit\test_orders_unit.py:94: in test_order_template_get_by_id_not_found
    assert response.status_code == 404
E   assert 401 == 404
E    +  where 401 = <Response [401 Unauthorized]>.status_code
________________ TestOrders.test_order_template_delete_success ________________
tests\unit\test_orders_unit.py:109: in test_order_template_delete_success
    assert response.status_code in [200, 204]
E   assert 401 in [200, 204]
E    +  where 401 = <Response [401 Unauthorized]>.status_code
______________ TestOrders.test_trading_execute_validation_error _______________
tests\unit\test_orders_unit.py:121: in test_trading_execute_validation_error
    assert response.status_code == 422
E   assert 403 == 422
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:106 [CSRF] Validation failed: Token not found
WARNING  app.middleware.security:security.py:176 [CSRF] Blocked request to /api/trading/execute: Invalid or expired token
___________________ TestPortfolio.test_get_account_success ____________________
tests\unit\test_portfolio_unit.py:44: in test_get_account_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
__________________ TestPortfolio.test_get_positions_success ___________________
tests\unit\test_portfolio_unit.py:75: in test_get_positions_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
______________ TestPortfolio.test_get_position_by_symbol_success ______________
tests\unit\test_portfolio_unit.py:89: in test_get_position_by_symbol_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
__________________ TestPositions.test_get_positions_success ___________________
tests\unit\test_positions_unit.py:43: in test_get_positions_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
________________ TestPositions.test_get_positions_unauthorized ________________
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\monkeypatch.py:90: in annotated_getattr
    obj = getattr(obj, name)
          ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'app.routers.positions' has no attribute 'settings'

The above exception was the direct cause of the following exception:
tests\unit\test_positions_unit.py:52: in test_get_positions_unauthorized
    monkeypatch.setattr("app.routers.positions.settings", mock_settings)
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\monkeypatch.py:104: in derive_importpath
    annotated_getattr(target, attr, ann=module)
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\monkeypatch.py:92: in annotated_getattr
    raise AttributeError(
E   AttributeError: 'module' object at app.routers.positions has no attribute 'settings'
_______________ TestPositions.test_get_portfolio_greeks_success _______________
tests\unit\test_positions_unit.py:72: in test_get_portfolio_greeks_success
    assert response.status_code == 200
E   assert 401 == 200
E    +  where 401 = <Response [401 Unauthorized]>.status_code
__________________ TestPositions.test_close_position_success __________________
tests\unit\test_positions_unit.py:84: in test_close_position_success
    assert response.status_code in [200, 201]
E   assert 403 in [200, 201]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:106 [CSRF] Validation failed: Token not found
WARNING  app.middleware.security:security.py:176 [CSRF] Blocked request to /api/positions/pos_12345/close: Invalid or expired token
______________ TestScheduler.test_create_scheduled_task_success _______________
tests\unit\test_scheduler_unit.py:45: in test_create_scheduled_task_success
    assert response.status_code in [200, 201, 404]
E   assert 403 in [200, 201, 404]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/scheduler/tasks: Missing X-CSRF-Token header
______________ TestScheduler.test_delete_scheduled_task_success _______________
tests\unit\test_scheduler_unit.py:52: in test_delete_scheduled_task_success
    assert response.status_code in [200, 204, 404]
E   assert 403 in [200, 204, 404]
E    +  where 403 = <Response [403 Forbidden]>.status_code
------------------------------ Captured log call ------------------------------
WARNING  app.middleware.security:security.py:162 [CSRF] Blocked request to /api/scheduler/tasks/task-123: Missing X-CSRF-Token header
============================== warnings summary ===============================
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\websockets\legacy\__init__.py:6
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\websockets\legacy\__init__.py:6: DeprecationWarning: websockets.legacy is deprecated; see https://websockets.readthedocs.io/en/stable/howto/upgrade.html for upgrade instructions
    warnings.warn(  # deprecated in 14.0 - 2024-11-09

..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\_internal\_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

app\main.py:32
app\main.py:32
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\app\main.py:32: DeprecationWarning: `example` has been deprecated, please use `examples` instead
    from .routers import (

app\routers\news.py:31
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\app\routers\news.py:31: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    sentiment: str | None = Query(default=None, regex="^(bullish|bearish|neutral)$"),

app\routers\news.py:106
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\app\routers\news.py:106: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    sentiment: str | None = Query(default=None, regex="^(bullish|bearish|neutral)$"),

..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\fields.py:1062
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\fields.py:1062: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)

..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\fields.py:1068
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pydantic\fields.py:1068: PydanticDeprecatedSince20: `max_items` is deprecated and will be removed, use `max_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warn('`max_items` is deprecated and will be removed, use `max_length` instead', DeprecationWarning)

app\main.py:307
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\app\main.py:307: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:4523
..\..\..\..\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:4523
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\fastapi\applications.py:4523: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

app\main.py:575
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\app\main.py:575: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("shutdown")

tests\integration\test_platform_integration.py:16
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\integration\test_platform_integration.py:16: PytestCollectionWarning: cannot collect test class 'TestResult' because it has a __init__ constructor (from: tests/integration/test_platform_integration.py)
    @dataclass

tests\test_rate_limiting.py:236
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\test_rate_limiting.py:236: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests\test_rate_limiting.py:379
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\test_rate_limiting.py:379: PytestUnknownMarkWarning: Unknown pytest.mark.mark - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    pytest.mark.slow = pytest.mark.mark("slow")

tests/contract/test_analytics_contracts.py::test_performance_metrics_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_performance_metrics_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_analytics_contracts.py::test_performance_metrics_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_performance_metrics_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_analytics_contracts.py::test_portfolio_history_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_portfolio_history_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_analytics_contracts.py::test_portfolio_history_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_portfolio_history_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_market_contracts.py::test_quote_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_quote_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_market_contracts.py::test_quote_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_quote_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_market_contracts.py::test_indices_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_indices_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_market_contracts.py::test_indices_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_indices_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_market_contracts.py::test_market_conditions_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_market_conditions_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_market_contracts.py::test_market_conditions_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_market_conditions_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_market_contracts.py::test_sectors_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_sectors_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_market_contracts.py::test_sectors_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_sectors_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_portfolio_contracts.py::test_portfolio_summary_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_portfolio_summary_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_portfolio_contracts.py::test_portfolio_summary_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_portfolio_summary_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_portfolio_contracts.py::test_positions_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_positions_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_portfolio_contracts.py::test_positions_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_positions_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/contract/test_portfolio_contracts.py::test_account_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\_pytest\fixtures.py:1182: PytestRemovedIn9Warning: 'test_account_contract' requested an async fixture 'client', with no plugin or hook that handled it. This is usually an error, as pytest does not natively support it. This will turn into an error in pytest 9.
  See: https://docs.pytest.org/en/stable/deprecations.html#sync-test-depending-on-async-fixture
    warnings.warn(

tests/contract/test_portfolio_contracts.py::test_account_contract
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\pytest_asyncio\plugin.py:678: PytestDeprecationWarning: asyncio test 'test_account_contract' requested async @pytest.fixture 'client' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of pytest-asyncio.
    warnings.warn(

tests/integration/test_ai_recommendation_flow_integration.py: 12 warnings
tests/integration/test_auth_integration.py: 3 warnings
tests/integration/test_auth_integration_enhanced.py: 34 warnings
tests/integration/test_market_data_flow_integration.py: 32 warnings
tests/integration/test_monitoring_integration.py: 2 warnings
tests/integration/test_options_trading_integration.py: 18 warnings
tests/integration/test_portfolio_management_integration.py: 24 warnings
tests/integration/test_trading_flow_integration.py: 8 warnings
tests/test_analytics.py: 18 warnings
tests/test_api_endpoints.py: 30 warnings
tests/test_auth.py: 14 warnings
tests/test_database.py: 84 warnings
tests/test_market.py: 32 warnings
tests/test_news.py: 30 warnings
tests/test_security.py: 14 warnings
tests/test_strategies.py: 6 warnings
tests/unit/test_ai_unit.py: 18 warnings
tests/unit/test_analytics_unit.py: 18 warnings
tests/unit/test_ml_sentiment_unit.py: 4 warnings
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\sqlalchemy\sql\schema.py:3624: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    return util.wrap_callable(lambda ctx: fn(), fn)  # type: ignore

tests/integration/test_market_data_flow_integration.py::TestMarketDataPerformance::test_concurrent_quote_requests
  C:\Users\SSaint-Cyr\Documents\GitHub\PaiiD\backend\tests\conftest.py:111: SAWarning: Usage of the 'Session.add()' operation is not currently supported within the execution stage of the flush process. Results may not be consistent.  Consider using alternative event listeners or connection-level operations instead.
    test_db.add(user)

tests/unit/test_ml_sentiment_unit.py::TestMLSentiment::test_get_sentiment_analysis_unauthorized
  C:\Users\SSaint-Cyr\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.12_qbz5n2kfra8p0\LocalCache\local-packages\Python312\site-packages\starlette\_exception_handler.py:63: RuntimeWarning: coroutine 'get_redis' was never awaited
    await response(scope, receive, sender)
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.12.10-final-0 _______________

Name                                          Stmts   Miss  Cover   Missing
---------------------------------------------------------------------------
app\__init__.py                                   0      0   100%
app\core\__init__.py                              0      0   100%
app\core\auth.py                                 25     25     0%   1-89
app\core\config.py                               82     24    71%   191-198, 204-215, 221-231, 274, 278-280
app\core\idempotency.py                          45     33    27%   11-12, 22-31, 39-71
app\core\jwt.py                                  86     35    59%   51, 87, 167, 172, 174, 176, 204-260, 276-280, 311-330
app\core\kill_switch.py                           9      2    78%   10-11
app\core\logging_utils.py                        74     10    86%   77, 84, 105, 109, 126, 152, 173, 228, 232, 236
app\core\prelaunch.py                           180     63    65%   66-68, 77, 99-103, 127-128, 138-142, 166, 172, 176-185, 202-218, 240, 248, 256, 269, 329-330, 343-346, 389-391, 394-396, 401, 410-436, 440
app\core\redis_client.py                        124     96    23%   23-25, 29-44, 48-51, 55-61, 65-72, 76, 80-87, 91-97, 101-107, 111-119, 123, 130, 148-150, 167-175, 179-183, 194-200, 206-209, 214-218
app\core\signals.py                              83     62    25%   23-29, 34-40, 57-117, 123-130, 144-146
app\core\startup_monitor.py                      75     29    61%   64-68, 72-83, 88-89, 103-105, 108, 114-117, 152-156
app\core\startup_validator.py                   142     47    67%   78-80, 104-105, 120-138, 148-159, 164-165, 184-189, 196-199, 213-217, 236, 256-257
app\core\store.py                                38     38     0%   1-57
app\core\unified_auth.py                         96     50    48%   47-51, 69-70, 76-77, 113-134, 139-140, 153-195, 199-205, 237, 259-285
app\core\validators.py                           84     51    39%   27-39, 52, 73-76, 85-96, 105-107, 112-114, 119-121, 130-140, 145-153, 159-164, 169-174
app\db\__init__.py                                0      0   100%
app\db\session.py                                19      4    79%   26-32, 64-65
app\main.py                                     286     70    76%   64-94, 139, 286, 303, 312-313, 363-364, 397-422, 442, 444, 450-457, 469-470, 475-482, 496-498, 506-507, 514-515, 551-555, 583-584, 604, 614-615, 623-625, 628-629, 642-644
app\middleware\__init__.py                        6      0   100%
app\middleware\cache_control.py                  21      3    86%   39, 47, 51
app\middleware\correlation_id.py                 27     27     0%   13-82
app\middleware\kill_switch.py                    12      0   100%
app\middleware\metrics.py                        16      0   100%
app\middleware\rate_limit.py                     26      7    73%   25, 55-62, 88, 93, 98
app\middleware\request_id.py                     14      0   100%
app\middleware\security.py                       93     30    68%   101-102, 109-123, 134, 137, 145-147, 186-192, 205-245, 259
app\middleware\security_headers.py               16      0   100%
app\middleware\sentry.py                         30     19    37%   23-95, 107, 122, 144
app\middleware\validation.py                     66     33    50%   33, 38, 58, 61, 64, 79, 96, 110-120, 134-144, 161-173, 186-187, 198, 210, 222
app\ml\__init__.py                                6      0   100%
app\ml\advanced_patterns.py                     335    335     0%   6-980
app\ml\data_pipeline.py                         114     98    14%   29-32, 53-108, 121-147, 168-239, 255-297, 307-309
app\ml\ensemble.py                              130    130     0%   10-322
app\ml\feature_engineering.py                   130    109    16%   22-24, 38, 55-86, 90-121, 125-150, 154-184, 188-209, 213-240, 249, 305-313
app\ml\market_regime.py                         151    130    14%   41-45, 57-113, 126-167, 182-233, 246-312, 328-347, 359-374, 386-400, 410-412
app\ml\pattern_recognition.py                   204    182    11%   58-66, 70, 103, 116-148, 152-255, 259-372, 376-479, 483-566, 576-578
app\ml\regime_detection.py                      379    373     2%   8-772
app\ml\sentiment_analyzer.py                     91     61    33%   52-68, 91-119, 131, 151, 173-219, 231-243
app\ml\signal_generator.py                      149    102    32%   91-151, 163-234, 246-267, 282-303, 314-340, 344
app\ml\strategy_selector.py                     187    165    12%   44-56, 75-208, 220-251, 270-337, 356-423, 435-450, 462-476, 486-488
app\models\__init__.py                            3      0   100%
app\models\database.py                          185      8    96%   74, 111, 155, 265, 313, 344, 379, 442
app\models\ml_analytics.py                      132      5    96%   75, 147, 210, 294, 344
app\routers\__init__.py                           0      0   100%
app\routers\ai.py                               889    486    45%   135, 147-238, 327-330, 394-398, 414-416, 425-491, 542, 582, 585-590, 600-609, 617-620, 626-631, 692-694, 711-733, 763-776, 781-804, 818-830, 843-844, 851-863, 879-884, 889-891, 898-904, 941-1043, 1067-1167, 1196-1199, 1219-1290, 1312-1393, 1409-1441, 1458-1545, 1600-1613, 1635, 1642-1647, 1653-1658, 1662-1667, 1715-1717, 1744, 1750-1752, 1797-1838, 1870-1931, 1984, 2003-2012, 2027-2037, 2093, 2095, 2117-2119, 2141-2144, 2149-2154, 2163, 2169, 2173, 2187, 2189, 2206, 2242-2352, 2374-2398
app\routers\analytics.py                        204      4    98%   375-376, 404-405
app\routers\auth.py                             122     37    70%   54, 56, 58, 125-129, 174, 205, 232, 247-263, 287-347, 363
app\routers\backtesting.py                       66     32    52%   103-182, 198-222, 232-279
app\routers\claude.py                            70     32    54%   31, 42-43, 56-59, 78-123, 129-132
app\routers\health.py                           173     73    58%   65-69, 119-121, 130-159, 168-187, 195-198, 215-218, 224-257, 289-303, 332-333, 355-356, 368, 378-379
app\routers\market.py                           238    154    35%   51-258, 288-289, 294, 317, 353, 361, 391, 393, 403-405, 427-523, 556-557, 595-600
app\routers\market_data.py                      195    124    36%   44-67, 73-75, 81-99, 101, 124-144, 158-164, 173-192, 221-225, 247, 251, 262-283, 302-367, 382-404, 455-542, 559-574
app\routers\ml.py                               288    232    19%   72-74, 100-124, 149-151, 188-194, 212-214, 240-264, 291-316, 345-479, 496-619, 636-682, 701-719, 743-923, 944-1107, 1134-1159
app\routers\ml_advanced.py                        0      0   100%
app\routers\ml_sentiment.py                     201    126    37%   96-98, 123-138, 164-166, 191-275, 293-362, 388-390, 418-577
app\routers\monitor.py                          115    115     0%   6-278
app\routers\monitoring.py                       216    110    49%   123-133, 137-149, 158-177, 186-229, 233-251, 262-288, 292-325, 329-370, 380-386, 395-409, 419-420, 429-430, 440-441, 451-452, 467-507, 519, 535-543, 554-558, 591, 600
app\routers\news.py                              98     61    38%   23-24, 46-99, 122, 136, 153-166, 183-190, 210-220, 236-291, 297-300, 306-310, 322-332
app\routers\options.py                          205    125    39%   138-177, 188-193, 201, 209-297, 303, 334-338, 343-379, 387-419, 422-423, 464-512, 533-573, 590-603
app\routers\orders.py                           308    148    52%   42, 68-71, 75-80, 87-102, 166, 172, 178, 184, 190-191, 197-200, 206-209, 215-220, 245-316, 343, 349-355, 368-415, 420-421, 471-472, 491-493, 498-500, 505-507, 512-514, 582-585, 596-621, 631-639, 649-658
app\routers\portfolio.py                         79     19    76%   59-60, 80-81, 90-94, 108-126
app\routers\positions.py                         51     37    27%   30-75, 81-92, 102-114
app\routers\proposals.py                         45     22    51%   87-111, 153-176, 191
app\routers\scheduler.py                        282    185    34%   107-111, 116-118, 123-125, 130-134, 139-148, 153-165, 170-176, 187-224, 235-277, 287-326, 334-346, 357-371, 377-391, 406-416, 429-438, 446-475, 485-514, 525-537
app\routers\screening.py                         22     12    45%   39-54, 68-74
app\routers\settings.py                          26      9    65%   30-31, 40-50
app\routers\stock.py                             78     36    54%   77-105, 128-142, 160-193
app\routers\strategies.py                       171    117    32%   52-63, 84-95, 111-137, 149-169, 186-187, 203-232, 244-258, 280-330, 350-379, 402-408, 430-487
app\routers\stream.py                           136    110    19%   66-146, 166-225, 255-353
app\routers\telemetry.py                         52     34    35%   27-42, 56-75, 83-95, 103-115, 123-134
app\routers\users.py                             65     34    48%   53-55, 68-89, 106-129, 144-158
app\scheduler.py                                209    148    29%   56-59, 65-68, 78-79, 90-114, 118-124, 128-134, 138-144, 148-154, 158-164, 168-182, 203-204, 208-217, 221-227, 235-276, 280-298, 304-324, 328-337, 347-372, 382-398, 405-437, 448
app\schemas\__init__.py                           7      7     0%   8-32
app\schemas\ai.py                                68     68     0%   3-162
app\schemas\analytics.py                         50     50     0%   3-112
app\schemas\health.py                            13     13     0%   3-27
app\schemas\market.py                            49     49     0%   3-140
app\schemas\orders.py                            25     25     0%   3-55
app\schemas\portfolio.py                         22     22     0%   3-65
app\services\__init__.py                         20     10    50%   48-63, 78
app\services\alert_manager.py                    95     95     0%   11-274
app\services\alerts.py                           32     32     0%   5-97
app\services\alpaca_client.py                    85     56    34%   26, 41-44, 73-103, 107-135, 139-174, 178-229, 233-240
app\services\alpaca_options.py                  117     99    15%   25-46, 65-168, 180-241, 253-270, 282-320, 324-330, 334-337, 347-349
app\services\backtesting_engine.py              210    154    27%   83-88, 93-108, 113-115, 129-166, 176-198, 217-338, 343-420
app\services\cache.py                            83     47    43%   28-32, 43-44, 66-75, 92-98, 110-118, 130-138, 150-163
app\services\cache_service.py                   204    172    16%   31-36, 40, 44, 48, 52, 56, 60-64, 77-82, 105-123, 132-147, 164-191, 214-243, 255-276, 293-327, 361-372, 396-408, 417-430, 434-435, 443-454, 463-477, 511-514, 524-525
app\services\counter_manager.py                  92     92     0%   6-230
app\services\equity_tracker.py                  108     86    20%   42-76, 80-87, 91-97, 112-130, 147-229
app\services\fixture_loader.py                  141    141     0%   8-518
app\services\github_monitor.py                  148    148     0%   6-347
app\services\greeks.py                           17      7    59%   24-33, 49, 64, 80, 95
app\services\health_monitor.py                   65      0   100%
app\services\historical_data.py                  42     33    21%   26-28, 50-67, 82-93, 97-117
app\services\market_analysis_service.py         167    152     9%   46-48, 78-159, 192-276, 309-361, 385-442, 474-490
app\services\market_data.py                       0      0   100%
app\services\model_persistence.py                91     91     0%   6-221
app\services\news\__init__.py                     0      0   100%
app\services\news\alpha_vantage_provider.py      46     16    65%   12, 16-35, 55-57
app\services\news\base_provider.py               28      4    86%   23, 44, 48, 52
app\services\news\finnhub_provider.py            37     14    62%   13, 18-26, 32-34, 54, 56
app\services\news\news_aggregator.py            191     82    57%   57-69, 79-91, 95, 118-119, 129-130, 140-141, 144, 174-177, 191-205, 221-249, 278-279, 290-306, 311, 358-363, 368-373, 388, 390-399, 402, 411-449
app\services\news\news_cache.py                 125     77    38%   50-85, 134-139, 150-170, 180-189, 193-202, 206-248
app\services\news\polygon_provider.py            40     16    60%   12, 17-31, 46-48
app\services\notification_service.py            156    102    35%   86-89, 114-145, 173-200, 221-253, 270-292, 313-331, 350-361, 378-386, 398-407, 422, 439-441, 445-447, 451-458, 464-466, 474, 488, 525-528
app\services\options_greeks.py                   92     61    34%   82-123, 144-149, 162-174, 184-189, 200-203, 217-239, 245-248, 258-266, 272-279, 302-304, 333-334
app\services\order_execution.py                 111     75    32%   44-45, 66-119, 136-171, 179-194, 207-227, 231-234, 238-244, 258-279, 296-298
app\services\portfolio_analytics_service.py     156    140    10%   38, 72-180, 204-255, 286-305, 326-360, 389-432, 456-477, 493-529, 559-569
app\services\position_tracker.py                104     61    41%   52-54, 58-103, 107-114, 124-159, 163-186, 191, 196-201, 206-217, 221-223
app\services\screening_service.py                55     31    44%   32-34, 39, 117, 168, 229-230, 234-235, 241-249, 274-302, 311, 357-359
app\services\stock_analysis_service.py           85     68    20%   37-50, 54, 84-89, 93, 114-115, 131-190, 205-239, 256-264, 280-293, 313
app\services\strategy_execution_service.py       73     43    41%   36, 55-85, 104-142, 158-170, 196-220, 244-252
app\services\strategy_templates.py               84     63    25%   239, 244-247, 260-270, 286-309, 330-377, 387
app\services\technical_indicators.py            190    168    12%   34-54, 66-86, 102-118, 130-138, 158-181, 191-205, 210-221, 231-280, 297-396
app\services\telemetry_service.py                86     59    31%   44-49, 53, 73-74, 86-104, 127-146, 155-195, 214-217, 226, 240-242
app\services\tradier_client.py                  151     61    60%   36, 59, 62-64, 89-91, 109, 114-126, 132-141, 145-148, 166-174, 198-214, 218, 229-233, 241-244, 289-318
app\services\tradier_stream.py                  298    114    62%   108-109, 117-124, 138-142, 168-174, 177-178, 189-214, 219-220, 240, 256-263, 268-270, 291-304, 307-314, 324-325, 337-338, 350-351, 364, 405, 408-487, 490, 492, 532-550, 558-559, 594-595, 618-625, 637-644
app\services\user_management_service.py          72     54    25%   30-34, 38, 57-60, 64, 82, 97-107, 131-174, 192-210, 230-248, 261
app\utils\__init__.py                             0      0   100%
app\utils\query_profiler.py                      62     37    40%   31-99, 129, 165-168, 171-172, 175-188
---------------------------------------------------------------------------
TOTAL                                         12768   8073    37%
=========================== short test summary info ===========================
SKIPPED [1] tests\integration\test_ai_recommendation_flow_integration.py:202: AI stock analysis endpoint not found
SKIPPED [1] tests\integration\test_ai_recommendation_flow_integration.py:232: AI sentiment analysis endpoint not found
SKIPPED [1] tests\integration\test_ai_recommendation_flow_integration.py:306: ML prediction endpoint not found
SKIPPED [1] tests\integration\test_ai_recommendation_flow_integration.py:315: ML status endpoint not implemented
SKIPPED [1] tests\integration\test_ai_recommendation_flow_integration.py:331: ML training status endpoint not implemented
SKIPPED [1] tests\integration\test_auth_integration_enhanced.py:183: Authentication setup failed
SKIPPED [1] tests\integration\test_auth_integration_enhanced.py:214: Authentication setup failed
SKIPPED [1] tests\integration\test_backtesting_flow_integration.py:98: Strategy list endpoint not implemented
SKIPPED [1] tests\integration\test_backtesting_flow_integration.py:384: Backtest trade history endpoint not implemented
SKIPPED [1] tests\integration\test_backtesting_flow_integration.py:408: Backtest equity curve endpoint not implemented
SKIPPED [1] tests\integration\test_market_data_flow_integration.py:161: Historical bars endpoint not found or not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:100: Services health endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:151: Metrics endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:177: Request metrics endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:203: Endpoint metrics not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:219: Error metrics endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:249: Metrics time series endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:293: Active alerts endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:310: Alert history endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:341: Service monitoring endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:365: Service monitoring endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:379: Circuit breaker monitoring not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:425: Database pool monitoring not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:450: Cache statistics endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:476: Memory monitoring endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:505: Logs endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:536: Logs endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:556: Audit logs endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:577: Uptime endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:604: Availability endpoint not implemented
SKIPPED [1] tests\integration\test_monitoring_integration.py:648: Metrics endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:35: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:67: Symbol-specific news endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:97: Multi-symbol news endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:121: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:148: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:172: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:214: Symbol sentiment endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:237: Sentiment trend endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:297: News signals endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:318: News recommendations endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:353: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:415: News watchlist endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:438: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:459: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:484: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:513: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:526: News endpoint not implemented
SKIPPED [1] tests\integration\test_news_analysis_integration.py:546: News endpoint not implemented
SKIPPED [1] tests\integration\test_options_trading_integration.py:124: Cannot get stock quote for options test
SKIPPED [1] tests\integration\test_options_trading_integration.py:321: Multi-leg options proposals not implemented
SKIPPED [1] tests\integration\test_options_trading_integration.py:335: Options proposal endpoint not implemented
SKIPPED [1] tests\integration\test_options_trading_integration.py:445: Implied volatility endpoint not implemented
SKIPPED [1] tests\integration\test_options_trading_integration.py:488: Options scanner not implemented
SKIPPED [1] tests\integration\test_portfolio_management_integration.py:243: Portfolio analytics endpoint not found
SKIPPED [1] tests\integration\test_portfolio_management_integration.py:323: Portfolio history endpoint not found
SKIPPED [1] tests\integration\test_portfolio_management_integration.py:371: Account activity endpoint not found
ERROR tests/integration/test_auth_integration.py::TestAuthenticationPerformance::test_login_response_time
ERROR tests/integration/test_auth_integration.py::TestAuthenticationPerformance::test_session_validation_response_time
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_order_validation_flow
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_market_buy_execution
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_limit_order_execution
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_sell_order_execution
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_insufficient_balance_validation
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_invalid_symbol_validation
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_negative_quantity_validation
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_order_cancellation
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_trade_history_retrieval
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_concurrent_order_execution
ERROR tests/integration/test_trading_integration.py::TestTradingIntegration::test_portfolio_update_after_trade
ERROR tests/integration/test_trading_integration.py::TestTradingPerformance::test_order_validation_response_time
ERROR tests/integration/test_trading_integration.py::TestTradingPerformance::test_order_execution_response_time
FAILED tests/contract/test_analytics_contracts.py::test_performance_metrics_contract
FAILED tests/contract/test_analytics_contracts.py::test_portfolio_history_contract
FAILED tests/contract/test_market_contracts.py::test_quote_contract - Attribu...
FAILED tests/contract/test_market_contracts.py::test_indices_contract - Attri...
FAILED tests/contract/test_market_contracts.py::test_market_conditions_contract
FAILED tests/contract/test_market_contracts.py::test_sectors_contract - Attri...
FAILED tests/contract/test_portfolio_contracts.py::test_portfolio_summary_contract
FAILED tests/contract/test_portfolio_contracts.py::test_positions_contract - ...
FAILED tests/contract/test_portfolio_contracts.py::test_account_contract - At...
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIRecommendationFlow::test_fetch_ai_recommendations
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIRecommendationFlow::test_ai_recommendation_with_market_context
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIRecommendationFlow::test_ai_recommendation_filtering
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIAnalysisFlow::test_ai_chat_interface
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIAnalysisFlow::test_ai_strategy_generation
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIRecommendationPerformance::test_ai_recommendation_history
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIRecommendationPerformance::test_ai_recommendation_accuracy
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIRecommendationPerformance::test_ai_recommendation_feedback
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIErrorHandling::test_ai_api_unavailable
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIErrorHandling::test_ai_timeout_handling
FAILED tests/integration/test_ai_recommendation_flow_integration.py::TestAIErrorHandling::test_invalid_ai_request
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_user_registration_flow
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_user_login_flow
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_login_with_invalid_credentials
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_session_validation
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_session_without_token
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_session_with_invalid_token
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_logout_flow
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_token_refresh
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_duplicate_email_registration
FAILED tests/integration/test_auth_integration.py::TestAuthenticationIntegration::test_password_strength_validation
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_user_registration_complete_flow
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_user_login_with_valid_credentials
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_login_with_invalid_password
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_session_validation_without_token
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_session_validation_with_invalid_token
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_token_refresh_flow
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_duplicate_email_registration
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_password_strength_validation
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_email_format_validation
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_risk_tolerance_validation
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationIntegrationEnhanced::test_concurrent_login_attempts
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationSecurity::test_sql_injection_protection
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationSecurity::test_password_not_logged
FAILED tests/integration/test_auth_integration_enhanced.py::TestAuthenticationSecurity::test_token_expiration
FAILED tests/integration/test_backtesting_flow_integration.py::TestStrategyCreationFlow::test_create_simple_strategy
FAILED tests/integration/test_backtesting_flow_integration.py::TestStrategyCreationFlow::test_create_complex_strategy
FAILED tests/integration/test_backtesting_flow_integration.py::TestBacktestErrorHandling::test_invalid_date_range
FAILED tests/integration/test_backtesting_flow_integration.py::TestBacktestErrorHandling::test_missing_strategy_id
FAILED tests/integration/test_backtesting_flow_integration.py::TestBacktestErrorHandling::test_backtest_timeout_handling
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataFlow::test_single_quote_retrieval
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataFlow::test_multiple_symbol_quotes
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataFlow::test_batch_quote_retrieval
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataFlow::test_market_indices_retrieval
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataFlow::test_quote_caching_behavior
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataFlow::test_special_characters_in_symbol
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataPerformance::test_quote_response_time
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataPerformance::test_concurrent_quote_requests
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataIntegration::test_quote_to_order_flow
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataIntegration::test_market_data_for_analytics
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataIntegration::test_streaming_data_availability
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataErrorHandling::test_api_timeout_handling
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataErrorHandling::test_rate_limit_handling
FAILED tests/integration/test_market_data_flow_integration.py::TestMarketDataErrorHandling::test_circuit_breaker_behavior
FAILED tests/integration/test_monitoring_integration.py::TestAlertingSystem::test_create_alert_rule
FAILED tests/integration/test_monitoring_integration.py::TestAlertingSystem::test_acknowledge_alert
FAILED tests/integration/test_news_analysis_integration.py::TestNewsIntegrationWithTrading::test_news_alerts_integration
FAILED tests/integration/test_options_trading_integration.py::TestOptionsChainFlow::test_fetch_options_chain
FAILED tests/integration/test_options_trading_integration.py::TestOptionsProposalsFlow::test_generate_options_proposal
FAILED tests/integration/test_options_trading_integration.py::TestOptionsOrderExecution::test_options_order_validation
FAILED tests/integration/test_options_trading_integration.py::TestOptionsOrderExecution::test_options_position_tracking
FAILED tests/integration/test_options_trading_integration.py::TestOptionsErrorHandling::test_invalid_expiration_date
FAILED tests/integration/test_options_trading_integration.py::TestOptionsErrorHandling::test_options_api_timeout
FAILED tests/integration/test_options_trading_integration.py::TestOptionsErrorHandling::test_zero_contracts_rejection
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioManagementFlow::test_fetch_portfolio_summary
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioManagementFlow::test_fetch_positions
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioManagementFlow::test_position_creation_after_buy
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioManagementFlow::test_position_reduction_after_sell
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioManagementFlow::test_portfolio_value_calculation
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioAnalytics::test_portfolio_diversification_metrics
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioAnalytics::test_position_profit_loss_tracking
FAILED tests/integration/test_portfolio_management_integration.py::TestAccountManagement::test_account_balance_retrieval
FAILED tests/integration/test_portfolio_management_integration.py::TestAccountManagement::test_account_settings_update
FAILED tests/integration/test_portfolio_management_integration.py::TestPositionManagement::test_individual_position_details
FAILED tests/integration/test_portfolio_management_integration.py::TestPositionManagement::test_close_entire_position
FAILED tests/integration/test_portfolio_management_integration.py::TestPositionManagement::test_position_cost_basis_tracking
FAILED tests/integration/test_portfolio_management_integration.py::TestPortfolioErrorHandling::test_positions_empty_state
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_complete_buy_flow
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_complete_sell_flow
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_limit_order_flow
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_multi_symbol_trading_flow
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_portfolio_update_after_trades
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_order_validation_before_placement
FAILED tests/integration/test_trading_flow_integration.py::TestCompleteTradingFlow::test_concurrent_orders_handling
FAILED tests/integration/test_trading_flow_integration.py::TestTradingFlowErrorHandling::test_network_timeout_handling
FAILED tests/integration/test_trading_flow_integration.py::TestTradingFlowErrorHandling::test_duplicate_order_idempotency
FAILED tests/test_backtest.py::test_backtest_endpoint_exists - assert 403 in ...
FAILED tests/test_backtest.py::test_backtest_with_different_symbols - Asserti...
FAILED tests/test_backtest.py::test_backtest_validates_date_range - assert 40...
FAILED tests/test_backtest.py::test_backtest_validates_initial_capital - asse...
FAILED tests/test_backtest.py::test_backtest_sma_crossover_strategy - assert ...
FAILED tests/test_database.py::TestStrategyModel::test_strategy_last_backtest_timestamp
FAILED tests/test_health.py::TestHealthMonitor::test_cache_hit_rate_calculation
FAILED tests/test_health.py::TestHealthMonitorIntegration::test_health_endpoint_detailed_requires_auth
FAILED tests/test_health.py::TestHealthMonitorIntegration::test_health_endpoint_detailed_with_auth
FAILED tests/test_integration.py::TestMarketDataEndpoints::test_get_options_chain
FAILED tests/test_integration.py::TestMLEndpoints::test_detect_patterns - ass...
FAILED tests/test_integration.py::TestMLEndpoints::test_market_regime_detection
FAILED tests/test_integration.py::TestTradingEndpoints::test_get_account_balance
FAILED tests/test_integration.py::TestTradingEndpoints::test_get_positions - ...
FAILED tests/test_integration.py::TestErrorHandling::test_invalid_symbol_returns_404
FAILED tests/test_integration.py::TestErrorHandling::test_malformed_request_returns_422
FAILED tests/test_load_baseline.py::test_load_market_indices - AssertionError...
FAILED tests/test_load_baseline.py::test_load_ai_recommendations - AssertionE...
FAILED tests/test_load_baseline.py::test_load_strategy_templates - AssertionE...
FAILED tests/test_load_baseline.py::test_load_portfolio_summary - AssertionEr...
FAILED tests/test_load_baseline.py::test_load_positions - AssertionError: Pos...
FAILED tests/test_load_baseline.py::test_load_news - AssertionError: News suc...
FAILED tests/test_load_baseline.py::test_comprehensive_load_baseline - httpx....
FAILED tests/test_market.py::test_market_indices_requires_auth - assert 200 i...
FAILED tests/test_rate_limiting.py::TestRateLimitBasics::test_rate_limit_headers_present_in_production_mode
FAILED tests/test_rate_limiting.py::TestRateLimitExceededHandler::test_rate_limit_exceeded_handler_format
FAILED tests/test_rate_limiting.py::TestRateLimitExceededHandler::test_rate_limit_exceeded_handler_retry_after_extraction
FAILED tests/test_rate_limiting.py::TestRateLimitDecorators::test_rate_limit_decorator_application
FAILED tests/test_rate_limiting.py::TestRateLimitConfiguration::test_rate_limiter_initialized
FAILED tests/test_rate_limiting.py::TestRateLimitConfiguration::test_rate_limiter_configuration_production
FAILED tests/test_rate_limiting.py::TestRateLimitIPKeying::test_rate_limit_key_function
FAILED tests/test_rate_limiting.py::TestRateLimitEndpointTypes::test_mutation_endpoints_callable
FAILED tests/test_rate_limiting.py::TestRateLimitResetBehavior::test_rate_limit_would_reset_after_window
FAILED tests/test_rate_limiting.py::TestRateLimitHeaders::test_rate_limit_headers_format
FAILED tests/test_rate_limiting.py::TestRateLimitStorageBackend::test_memory_storage_in_test_mode
FAILED tests/test_security_headers.py::TestSecurityHeadersMiddlewareImplementation::test_middleware_registered
FAILED tests/test_strategies.py::test_strategies_requires_auth - assert 200 i...
FAILED tests/test_strategies.py::test_create_strategy - assert 403 in [201, 4...
FAILED tests/test_strategies.py::test_create_strategy_validation - assert 403...
FAILED tests/test_strategies.py::test_update_nonexistent_strategy - assert 40...
FAILED tests/test_strategies.py::test_delete_nonexistent_strategy - assert 40...
FAILED tests/unit/test_backtesting_unit.py::TestBacktesting::test_run_backtest_success
FAILED tests/unit/test_backtesting_unit.py::TestBacktesting::test_run_backtest_validation_error
FAILED tests/unit/test_backtesting_unit.py::TestBacktesting::test_run_backtest_insufficient_data
FAILED tests/unit/test_backtesting_unit.py::TestBacktesting::test_run_backtest_different_symbols
FAILED tests/unit/test_backtesting_unit.py::TestBacktesting::test_run_backtest_different_strategies
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_success
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_validation_error
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_api_not_configured
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_with_system_prompt
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_multiple_messages
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_xss_prevention
FAILED tests/unit/test_claude_unit.py::TestClaude::test_claude_chat_different_models
FAILED tests/unit/test_market_unit.py::TestMarket::test_get_quote_success - a...
FAILED tests/unit/test_market_unit.py::TestMarket::test_get_quotes_batch_success
FAILED tests/unit/test_market_unit.py::TestMarket::test_get_historical_bars_success
FAILED tests/unit/test_market_unit.py::TestMarket::test_get_market_scanner_success
FAILED tests/unit/test_ml_sentiment_unit.py::TestMLSentiment::test_get_sentiment_analysis_success
FAILED tests/unit/test_ml_sentiment_unit.py::TestMLSentiment::test_get_trade_signals_success
FAILED tests/unit/test_news_unit.py::TestNews::test_get_news_unauthorized - a...
FAILED tests/unit/test_news_unit.py::TestNews::test_get_market_news_success
FAILED tests/unit/test_options_unit.py::TestOptions::test_get_options_chain_success
FAILED tests/unit/test_options_unit.py::TestOptions::test_get_options_expirations_success
FAILED tests/unit/test_orders_unit.py::TestOrders::test_trading_execute_dry_run
FAILED tests/unit/test_orders_unit.py::TestOrders::test_order_templates_list_success
FAILED tests/unit/test_orders_unit.py::TestOrders::test_order_template_get_by_id_not_found
FAILED tests/unit/test_orders_unit.py::TestOrders::test_order_template_delete_success
FAILED tests/unit/test_orders_unit.py::TestOrders::test_trading_execute_validation_error
FAILED tests/unit/test_portfolio_unit.py::TestPortfolio::test_get_account_success
FAILED tests/unit/test_portfolio_unit.py::TestPortfolio::test_get_positions_success
FAILED tests/unit/test_portfolio_unit.py::TestPortfolio::test_get_position_by_symbol_success
FAILED tests/unit/test_positions_unit.py::TestPositions::test_get_positions_success
FAILED tests/unit/test_positions_unit.py::TestPositions::test_get_positions_unauthorized
FAILED tests/unit/test_positions_unit.py::TestPositions::test_get_portfolio_greeks_success
FAILED tests/unit/test_positions_unit.py::TestPositions::test_close_position_success
FAILED tests/unit/test_scheduler_unit.py::TestScheduler::test_create_scheduled_task_success
FAILED tests/unit/test_scheduler_unit.py::TestScheduler::test_delete_scheduled_task_success
= 172 failed, 296 passed, 57 skipped, 442 warnings, 15 errors in 1372.84s (0:22:52) =
